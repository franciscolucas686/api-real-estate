// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

datasource db {
  provider = "postgresql"
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id                    String    @id @default(uuid())
  email                 String    @unique
  password              String
  name                  String?

  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt

  refreshToken          String?
  refreshTokenExpiresAt DateTime?

  properties Property[]
}


enum BusinessCode {
  RENT
  SALE_DIRECT
  SALE_FINANCING
  EXCHANGE
}

model BusinessType {
  id        String        @id @default(uuid())
  code      BusinessCode  @unique
  name      String

  properties PropertyBusinessType[]

  createdAt DateTime @default(now())
}

model PropertyBusinessType {
  id              String @id @default(uuid())
  propertyId      String
  businessTypeId  String

  property        Property     @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  businessType    BusinessType @relation(fields: [businessTypeId], references: [id], onDelete: Cascade)

  @@unique([propertyId, businessTypeId])
}

enum PropertyType {
  HOUSE
  APARTMENT
  LAND
  SMALL_FARM
  COUNTRY_HOUSE
}

enum PropertyStatus {
  AVAILABLE
  SOLD
  RENTED
  RESERVED
}

enum SunPosition {
  MORNING
  AFTERNOON
}

enum Zoning {
  RESIDENTIAL
  COMMERCIAL
  MIXED
}

enum Topography {
  FLAT
  ACCLIVITY
  DECLIVITY
}

enum WaterSource {
  WELL        // Poço
  SPRING      // Nascente
  MAINS       // Rede (distribuição pública)
}

model Property {
  id            String         @id @default(uuid())
  code          String         @unique
  title         String
  description   String
  type          PropertyType
  status        PropertyStatus

  price         Decimal
  rentPrice     Decimal?
  condoFee      Decimal?

  totalArea     Float?
  builtArea     Float?

  bedrooms      Int?
  bathrooms     Int?
  parkingSpaces Int?

  state         String
  city          String
  neighborhood  String

  coverImage    String?

  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  deletedAt     DateTime?

  userId       String 
  user         User     @relation(fields: [userId], references: [id])

  images        PropertyImage[]

  house         House?
  apartment     Apartment?
  land          Land?
  smallfarm    SmallFarm?
  countryhouse CountryHouse?

  businessTypes PropertyBusinessType[]

  @@index([type, status])
  @@index([city, neighborhood])
}

model PropertyImage {
  id          String   @id @default(uuid())
  propertyId  String
  url         String
  isMain      Boolean  @default(false)
  
  createdAt   DateTime @default(now())

  property    Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)

  @@index([propertyId])
}


model House {
  id               String   @id @default(uuid())
  propertyId       String   @unique

  floors           Int
  isInCondominium  Boolean?

  condominiumName  String?
  condominiumAmenities String?

  property         Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
}

model Apartment {
  id           String      @id @default(uuid())
  propertyId   String      @unique

  floor        Int
  hasElevator  Boolean
  hasBalcony   Boolean
  sunPosition  SunPosition
  hasPool      Boolean?

  property     Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
}

model Land {
  id           String     @id @default(uuid())
  propertyId   String     @unique

  zoning       Zoning
  topography   Topography

  property     Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
}

model SmallFarm {
  id           String      @id @default(uuid())
  propertyId   String      @unique

  hasHouse     Boolean
  hasPool      Boolean
  hasLake      Boolean
  hasFruitTrees Boolean
  waterSource  WaterSource

  property     Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
}

model CountryHouse {
  id               String   @id @default(uuid())
  propertyId       String   @unique

  hasRiver         Boolean
  hasSpring        Boolean
  property         Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
}